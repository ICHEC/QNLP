# Performance Optimisations: MPI Autotuning

This directory consists of multiple SLURM run scripts to generate MPI tuning parameter configuration files, and then to comparing the performances of each configuration file on a chosen application. 

Note: the below scripts assume that the SLURM job scheduler is being used and run scripts are launched using the `sbatch` command.

## Generating a MPI tuning parameter configuration file

Two scripts are provided in this directory to generate a single MPI tuning parameter configuration file;

- `run_generate_mpi_param_autotune.sh`  -   launch script for generic CPP executable
- `run_generate_mpi_param_autotune_EndToEndApp.sh` - launch script for QNLP end-to-end Python script

Both scripts launch parallel jobs across the specified job allocation. Parameters can be easily changed to launch application for any relevant executable/script.

Upon completion of the job, a configuration with a `.dat` extension will be generated (extension name can easily be changed in the script). This configuration file contains the optimal MPI communication subroutines to use.

## Running an application using an MPI tuning parameter configuration file

To run an application using the previously generated configuration file, simply export the following environment variable as the generated configuration file in the run script;

```{bash}
export I_MPI_TUNING_BIN=<GENERATED-CONFIG-FILE>
```

Examples of this can be observed in `run_compare_tuning_models.sh` and `run_compare_tuning_models_EndToEndApp.sh`.

## Comparing different

A very simple way of gaining a potentially significant performance improvement is by specifying the environemt variable `I_MPI_TUNING_BIN` to a configuration file generated by the Intel parallel tool suite when installed. A further performance improvement can be obtained by running Intel MPI's Autotuning tool to generate a configuration file made specifically for your target application.

Scripts for running Intel MPI's Autotuning tool and comparing different versions of configuration files (ie running applications with generated configuration files) are provided in `mpi_autotune`.

### MPI's Autotuining

