# Build Steps for `intel-qnlp` on *NIX systems

### Load GCC, Intel Compiler and Cmake3 Environments
Load modules for GCC version 8.2.0, Intel-2019-u5 and Cmake3.

```
module load gcc/8.2.0 intel/2019u5 cmake3
```

Note: this step assumes that Environment Modules is used on the system and that GCC version 8.2.0, Intel-2019-u5 and Cmake3 is installed. The module names on your system may vary.

### Build environment configuration
Run the `setup_env.sh` script which pulls down and installs third party software required; Catch2, CLI11,Intel-Quantum Simulator (QS)S, mpi4py and pybind11. Notably, this includes the Intel-QS which executes the quantum gate calls under the hood of the library.

```
cd <PATH-TO-intel-qnlp>/intel-qnlp
./setup_env.sh
```

These dependencies will be installed in `intel-qnlp/third_party/` and `intel-qnlp/third_party/install/`.

Note: this step might take a while to execute.

### Set environment configuration
The `load_env.sh` script was generated by running `setup_env.sh`. It sets the environment variables for all of the dependencies installed in the previous step.

Set the environment variables by running `

```
source load_env.sh
```

### Cmake build steps
Run Cmake to create the Maklefile using the defined environment.
```
cd build
CXX=mpiicpc CC=mpiicc cmake .. -DCMAKE_C_COMPILER=mpiicc -DCMAKE_CXX_COMPILER=mpiicpc -DENABLE_MPI=1 -DENABLE_NATIVE=ON -DIqsMPI=ON -DIqsMKL=ON
```

Include the appropriate flag(s) at the end of the above CMake command to build with the following functionality enabled:
- Unit testing requires the `-DENABLE_TESTS=1` flag
- Gate logging reuires the `-DENABLE_LOGGING=1` flag
- Python bindings enabled (recommended) requires the `-DENABLE_PYTHON=1` flag

(ie. to enable all funtionality for a distributed compute system, run 
```
cd build
CXX=mpiicpc CC=mpiicc cmake .. -DCMAKE_C_COMPILER=mpiicc -DCMAKE_CXX_COMPILER=mpiicpc -DENABLE_MPI=1 -DENABLE_NATIVE=ON -DIqsMPI=ON -DIqsMKL=ON -DENABLE_TESTS=1 -DENABLE_LOGGING=1 -DENABLE_PYTHON=1
```
)
### Build from Makefile
Build the software and third party libraries;

```
make
```


# Build steps for applications using `intel-qnlp` on *NIX systems

After the above Build steps have been completed, and given a new instance of a session in your terminal (environment variables are reset), the following steps should be taken to build an application using `intel-qnlp`.

### Set-up of the appropriate environment variables
Load modules for GCC version 8.2.0, Intel-2019-u5 and Cmake3.

Note: this step assumes that Environment Modules is used on the system and that GCC version 8.2.0, Intel-2019-u5 and Cmake3 is installed. The module names on your system may vary.

```
module load gcc/8.2.0 intel/2019u5 cmake3
```

Run script to set-up envoronment for `intel-qnlp` and third-party software:

```
cd <PATH-TO-intel-qnlp>/intel-qnlp
source <PATH-TO-intel-qnlp>/intel-qnlp/load_env.sh
```

### Running applications using `intel-qnlp`

#### C++ Applciations
A number of sample applications written in C++ are provided in the subdirectories contained in `intel-qnlp/demos`. Each of these subdirectories has a Slurm run scripts which can be used to launch that application by executing

```
cd ${QNLP_ROOT}/intel-qnlp/demos
sbatch <RUN-SCRIPT.sh>
```

The job configuration and the problem specification can be defined by adjusting these run scripts.

#### Python Applications
Python applications can be run in two ways;

- A batch job submission
- An interactive job

##### Batch Submission
Note: it is assumed that Slurm is being used as the scheduler of jobs on the system. If this is not the case, make appropriate adjustments to the scripts.

A number of sample applications written in Python (using Python bindings to C++) are provided in the directory `intel-qnlp/modules/py/scripts`. Each of these Python scripts can be run by launching the Slurm run script `run_py_MPI.sh` provided. 

In order to do this the specific Python application script, application parameters, and job configuration parameters must be specified in the `run_py_MPI.sh` Slurm script.

Then the Slurm script should be submitted to the scheduler by running
```
cd ${QNLP_ROOT}/intel-qnlp/modules/py/scripts
sbatch run_py_MPI.sh
``` 

##### Interactive Job
An interactive job can be used to run any of the versions of the application; C++, Python batch submission, or Python interactive. However, it becomes very useful when combined with using Jupyter notebooks.

Sample workflows by using Jupyter notebooks are provided in `intel-qnlp/modules/py/nb`. Allocate an interactive job on your cluster. For Slurm this can be done by executing

```
srun -p <JOB-QUEUE> -N <NUM-NODES> -A <ACCOUNT-ID> -t <TIME-DAYS:HOURS:MINS:SECS> --pty bash
```


If you have an interactive GUI interface for your cluster (using VNC for example), you can run your Jupyter notebooks interactively. Alternatively, the interactive jobs run very well on a local machine, although the scaling of the problem size is then limited.


# Build steps for `intel-qnlp` on MacOS Mojave WIP



Note: to build on Mac OS-Mojave, the following command should be run to create the Makefile provided the softaware including Intel-QS was built appropriately for the target environment.
```
cd build
PATH=/opt/gcc/gcc91/bin:$PATH CC=mpicc CXX=mpicxx cmake ..
```



### Note: Running on Mac OS
To run an executable that uses the `intel-qnlp` library, the command must be prepended with the `DYLD_LIBRARY_PATH` path as follows.
```
DYLD_LIBRARY_PATH=/opt/gcc/gcc91/lib:${CONDA_PREFIX}/lib:${DYLD_LIBRARY_PATH} <PATH-TO-EXECUTABLE>/<EXECUTABLE>
```
