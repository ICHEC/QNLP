<!DOCTYPE html>
<html lang="en-us">
<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>Encoding data into state coefficients - QNLP</title>
<meta name="description" content="Quantum Natural Language Processing">
<meta name="generator" content="Hugo 0.66.0" />
<link href="/index.xml" rel="alternate" type="application/rss+xml">
<link rel="canonical" href="/examples/float_encode/">
<link rel="stylesheet" href="/css/theme.min.css">
<script src="https://use.fontawesome.com/releases/v5.0.6/js/all.js"></script>
<link rel="stylesheet" href="/css/chroma.min.css">
<script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jquery.easing@1.4.1/jquery.easing.min.js"></script>
<script src="/js/bundle.js"></script><style>
:root {}
</style>
<meta property="og:title" content="Encoding data into state coefficients" />
<meta property="og:description" content="Quantum Natural Language Processing" />
<meta property="og:type" content="website" />
<meta property="og:url" content="/examples/float_encode/" />
<meta property="og:image" content="/images/og-image.png"/>
<meta property="og:updated_time" content="2020-03-01T10:48:38+00:00" /><meta property="og:site_name" content="Hugo Techdoc Theme" />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="/images/og-image.png"/>

<meta name="twitter:title" content="Encoding data into state coefficients"/>
<meta name="twitter:description" content="Quantum Natural Language Processing"/>
<meta itemprop="name" content="Encoding data into state coefficients">
<meta itemprop="description" content="Quantum Natural Language Processing"><script type="text/javascript" async
  src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
  MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    displayMath: [['$$','$$']],
    processEscapes: true,
    processEnvironments: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
    TeX: { equationNumbers: { autoNumber: "AMS" },
         extensions: ["AMSmath.js", "AMSsymbols.js"] }
  }
  });
  MathJax.Hub.Queue(function() {
    
    
    
    var all = MathJax.Hub.getAllJax(), i;
    for(i = 0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });

  MathJax.Hub.Config({
  
  TeX: { equationNumbers: { autoNumber: "AMS" } }
  });
</script></head>
<body><div class="container"><header>
<h1>QNLP</h1>
<a href="https://github.com/ichec/qnlp" class="github"><i class="fab fa-github"></i></a>
<p class="description">Quantum Natural Language Processing</p>

</header>
<div class="global-menu">
<nav>
<ul>
<li><a href="/">Home</a></li>
<li><a href="/docs">QNLP API</a></li>
<li><a href="/about/">About QNLP</a></li></ul>
</nav>
</div>
<div class="content-container">
<main><h1>Encoding data into state coefficients</h1><p>This work presents some preliminary result of the project into encoding numerical values directly into the state coefficients. See notebook <code>EntanglementVectorCompare_py.ipynb</code> for a runnable example.</p>
<h1 id="encoding-data-into-state-coefficients-analogue-encoding">Encoding data into state coefficients (analogue encoding)</h1>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">os</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&#34;OMP_NUM_THREADS&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&#34;4&#34;</span>
</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="c1"># Load the wrqpped simulator as before</span>
<span class="kn">import</span> <span class="nn">PyQNLPSimulator</span> <span class="kn">as</span> <span class="nn">pqnlp</span>
<span class="kn">from</span> <span class="nn">PyQNLPSimulator</span> <span class="kn">import</span> <span class="n">PyQNLPSimulator</span> <span class="k">as</span> <span class="n">p</span>

<span class="c1"># Load the wrapped 2x2 matrix type; dcm =&gt; double complex matrix</span>
<span class="kn">from</span> <span class="nn">PyQNLPSimulator</span> <span class="kn">import</span> <span class="n">DCMatrix</span> <span class="k">as</span> <span class="n">dcm</span>

<span class="c1"># Load the QNLP python packages</span>
<span class="kn">import</span> <span class="nn">QNLP</span> <span class="kn">as</span> <span class="nn">q</span>

<span class="c1"># Useful for examining various product types</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">product</span>

<span class="c1"># Load numpy and matrix-based functions from scipy</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">scipy.linalg</span> <span class="kn">import</span> <span class="n">expm</span><span class="p">,</span> <span class="n">sinm</span><span class="p">,</span> <span class="n">cosm</span>
</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="c1"># Use nonlinear least squares to determine the coefficients of the states to encode the numerical vector data.</span>
<span class="c1"># Given the 2*num_qubits coefficients needed for each individual qubit, we solve f(x)=b, wherein the b is the </span>
<span class="c1"># data to be encoded, x are the qubit coefficients, where a 1d array of length N holds N/2 qubits, with the </span>
<span class="c1">#|0&gt; and |1&gt; states in alternating odd/even patterns, and f(x) is the kronecker producted coefficients of </span>
<span class="c1"># these individual qubit pure states.</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">scipy.optimize</span>

<span class="n">num_qubits</span> <span class="o">=</span> <span class="mi">2</span>

<span class="c1">#Function that computes the kronecker product of each individual qubit, and returns an array with each state coeff</span>
<span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="n">qubits</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="mi">2</span><span class="p">):</span>
        <span class="n">qubits</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span><span class="n">x</span><span class="p">[</span><span class="n">ii</span><span class="o">+</span><span class="mi">1</span><span class="p">]]))</span>
    <span class="n">coeffs</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span><span class="p">):</span>
        <span class="n">coeffs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">kron</span><span class="p">(</span><span class="n">coeffs</span><span class="p">,</span> <span class="n">qubits</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">coeffs</span><span class="p">)</span>

<span class="c1">#f(x) - b = 0 to be solved</span>
<span class="k">def</span> <span class="nf">nl_eqs</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">rhs</span><span class="p">):</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">-</span><span class="n">rhs</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">rhs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">res</span>

<span class="c1">#Vector data to encode</span>
<span class="n">data_vals</span> <span class="o">=</span> <span class="p">[</span><span class="mf">3.42</span><span class="p">,</span> <span class="mf">1.24</span><span class="p">,</span> <span class="mf">1.97</span><span class="p">,</span> <span class="mf">0.72</span><span class="p">]</span> <span class="c1">#np.ones(2**num_qubits)</span>

<span class="c1">#Initial values for the qubits. </span>
<span class="n">qubit_init_coeff</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">num_qubits</span><span class="p">)</span>

<span class="c1">#Constrained NL LSQ, with coefficients between -1 and 1. </span>
<span class="n">x</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">optimize</span><span class="o">.</span><span class="n">least_squares</span><span class="p">(</span><span class="n">nl_eqs</span><span class="p">,</span> <span class="n">qubit_init_coeff</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]),</span> <span class="n">args</span><span class="o">=</span><span class="n">data_vals</span><span class="p">)</span><span class="o">.</span><span class="n">x</span>
<span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="mi">2</span><span class="p">):</span>
    <span class="n">x</span><span class="p">[</span><span class="n">ii</span><span class="p">:</span><span class="n">ii</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">ii</span><span class="p">:</span><span class="n">ii</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">ii</span><span class="p">:</span><span class="n">ii</span><span class="o">+</span><span class="mi">2</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</code></pre></div><pre><code>[0.86632121 0.4994873  0.93989541 0.34146248]
</code></pre>
<p>Following the work of PRL 114 110504 (2015) we can achieve similar state coeffs by using the given data state. We can wrap the above method up into a function as follows.</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">encoding_data</span><span class="p">(</span><span class="n">data_vec</span><span class="p">):</span>
    <span class="c1">#Ensure we have enough qubits to encode string, and pad if data is non power of 2</span>
    <span class="n">dvec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data_vec</span><span class="p">)</span>
    <span class="n">lg2_len</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dvec</span><span class="p">))</span>
    <span class="n">required_qubits</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">lg2_len</span><span class="p">)</span>
    <span class="n">num_qubits</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">required_qubits</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">lg2_len</span> <span class="o">!=</span> <span class="n">required_qubits</span><span class="p">:</span>
        <span class="n">dz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="n">num_qubits</span><span class="p">)</span>
        <span class="n">dz</span><span class="p">[:</span><span class="n">dvec</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">dvec</span>
        <span class="n">dvec</span> <span class="o">=</span> <span class="n">dz</span>

    <span class="c1">#Assign initial values</span>
    <span class="n">qubit_init_coeff</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">num_qubits</span><span class="p">)</span>
    <span class="c1">#Perform NLLSQ</span>
    <span class="n">x</span> <span class="o">=</span>  <span class="n">scipy</span><span class="o">.</span><span class="n">optimize</span><span class="o">.</span><span class="n">least_squares</span><span class="p">(</span><span class="n">nl_eqs</span><span class="p">,</span> <span class="n">qubit_init_coeff</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]),</span> <span class="n">args</span><span class="o">=</span><span class="n">dvec</span><span class="p">)</span><span class="o">.</span><span class="n">x</span>
    
    <span class="c1">#Ensure the resulting states are normalised according to each qubit&#39;s coefficients</span>
    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="mi">2</span><span class="p">):</span>
        <span class="n">x</span><span class="p">[</span><span class="n">ii</span><span class="p">:</span><span class="n">ii</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">ii</span><span class="p">:</span><span class="n">ii</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">ii</span><span class="p">:</span><span class="n">ii</span><span class="o">+</span><span class="mi">2</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">x</span>
    
</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="n">y</span> <span class="o">=</span> <span class="n">encoding_data</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.9</span><span class="p">,</span><span class="mf">0.1</span><span class="p">])</span>
</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="n">num_samples</span> <span class="o">=</span> <span class="mi">3000</span>
</code></pre></div><p>Examine the encoding of data into a single qubit first. Extract the unitary evolution matrix corresponding with a $R_y(2\theta)$ rotation to place the qubit into the appropriate state</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="n">use_fusion</span> <span class="o">=</span> <span class="bp">False</span>
<span class="n">sim</span> <span class="o">=</span> <span class="n">p</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">use_fusion</span><span class="p">)</span>
<span class="n">normalise</span> <span class="o">=</span> <span class="bp">True</span>
<span class="n">gateOps</span> <span class="o">=</span> <span class="n">pqnlp</span><span class="o">.</span><span class="n">GateOps</span><span class="p">(</span><span class="n">sim</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="n">theta</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">4</span>
</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="n">expm</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="n">theta</span><span class="o">*</span><span class="mi">1j</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]]))</span>
</code></pre></div><pre><code>array([[0.92387953-0.38268343j, 0.        +0.j        ],
       [0.        +0.j        , 0.92387953-0.38268343j]])
</code></pre>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="n">sim</span><span class="o">.</span><span class="n">applyGateRotY</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">ii</span><span class="p">]))</span>
<span class="n">u_mat</span> <span class="o">=</span> <span class="n">gateOps</span><span class="o">.</span><span class="n">RY</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">ii</span><span class="p">]))</span>

<span class="k">print</span><span class="p">(</span><span class="s2">&#34;U matrix:= &#34;</span><span class="p">)</span>
<span class="k">print</span> <span class="p">(</span><span class="n">u_mat</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&#34;Applying matrix to state |0&gt; = [1,0]^T&#34;</span><span class="p">)</span>
<span class="k">print</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">u_mat</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]))</span>
</code></pre></div><pre><code>U matrix:= 
[[ 0.93989541+0.j -0.34146248+0.j]
 [ 0.34146248+0.j  0.93989541+0.j]]
Applying matrix to state |0&gt; = [1,0]^T
[[0.93989541+0.j 0.34146248+0.j]]
</code></pre>
<p>Now that we have a method to encode data into a single qubit, we can encode the full vector data into the entire register as follows. We begin by defining the starting location of the GHZ state we wish to encode data into. For that, we need to examine the control qubit (0) and apply a controlled $R_y$ operation if it is set, to ensure the test data is set into state $|00\ldots\rangle$ and the reference data in state $|11\ldots\rangle$.</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="c1"># In memory DB for storing values</span>
<span class="kn">import</span> <span class="nn">sqlite3</span>
<span class="k">if</span> <span class="s1">&#39;conn&#39;</span> <span class="ow">in</span> <span class="nb">globals</span><span class="p">():</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;:memory:&#39;</span><span class="p">)</span>
<span class="c1"># Get a cursor object</span>
<span class="n">cursor</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;
</span><span class="s1">    CREATE TABLE q_states(id INTEGER PRIMARY KEY, state_key TEXT,
</span><span class="s1">                       dtheta REAL, counts INTEGER, num_qubits INTEGER, measured_reg TEXT)
</span><span class="s1">&#39;&#39;&#39;</span><span class="p">)</span>
</code></pre></div><pre><code>&lt;sqlite3.Cursor at 0x1408fb6c0&gt;
</code></pre>
<p>In the next step, we compare two vectors, wherein one of the two is rotated through an angle, $\Delta \theta$, from $0$ to $2\pi$. The resulting counts are recorded into the previously created database, with the correspodning angle and state label.</p>
<p>In the previously coded examples, the measurement was required on the full set of qubits to examine the outcome. However, by applying another H gate to the auxiliary qubit, we can modify the phase given by the encoded states. Taking an estimate of the population as the counts in $\vert 0\rangle$ auxiliary state over the total number of samples gives an approx. for the dot product, as seen by the comparison with the numpy <code>dot(x,y)</code> function below the next cell.</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="n">circ</span> <span class="o">=</span> <span class="n">p</span><span class="p">(</span><span class="n">num_qubits</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">,</span> <span class="n">use_fusion</span><span class="p">)</span>

<span class="n">work_qubits</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_qubits</span><span class="p">)</span>
<span class="n">aux_qubit</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">work_qubits</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="n">circ</span><span class="o">.</span><span class="n">getNumQubits</span><span class="p">()</span>
</code></pre></div><pre><code>3
</code></pre>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="n">counts</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_samples</span><span class="p">):</span>
    <span class="n">circ</span><span class="o">.</span><span class="n">initRegister</span><span class="p">()</span>
    <span class="n">circ</span><span class="o">.</span><span class="n">applyGateH</span><span class="p">(</span><span class="n">aux_qubit</span><span class="p">);</span>           

    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="mi">2</span><span class="p">):</span>
        <span class="n">circ</span><span class="o">.</span><span class="n">applyGateCRotY</span><span class="p">(</span><span class="n">aux_qubit</span><span class="p">,</span> <span class="n">work_qubits</span><span class="p">[</span><span class="n">ii</span><span class="o">//</span><span class="mi">2</span><span class="p">],</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span> <span class="p">)</span>

    <span class="c1">#Next, encode the reference data by flipping the first bit to allow it into the |11&gt; state</span>
    <span class="n">circ</span><span class="o">.</span><span class="n">applyGateX</span><span class="p">(</span><span class="n">aux_qubit</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">),</span><span class="mi">2</span><span class="p">):</span>
        <span class="n">circ</span><span class="o">.</span><span class="n">applyGateCRotY</span><span class="p">(</span><span class="n">aux_qubit</span><span class="p">,</span> <span class="n">work_qubits</span><span class="p">[</span><span class="n">ii</span><span class="o">//</span><span class="mi">2</span><span class="p">],</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span> <span class="p">)</span>

    <span class="c1">#Encode the information into the phase of the auxiliary qubit</span>
    <span class="n">circ</span><span class="o">.</span><span class="n">applyGateH</span><span class="p">(</span><span class="n">aux_qubit</span><span class="p">)</span>

    <span class="c1">#ghz_circ.collapseToBasisZ(aux_qubit, 0)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">circ</span><span class="o">.</span><span class="n">applyMeasurementToRegister</span><span class="p">([</span><span class="n">aux_qubit</span><span class="p">],</span> <span class="bp">True</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">num_qubits</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&#34;_&#34;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="ow">in</span> <span class="n">counts</span><span class="p">:</span>
        <span class="n">counts</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">num_qubits</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&#34;_&#34;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="p">)]</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">counts</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">num_qubits</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&#34;_&#34;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">1</span>
    
<span class="k">print</span><span class="p">(</span><span class="n">counts</span><span class="p">)</span>
</code></pre></div><pre><code>{'2_0': 2867, '2_1': 133}
</code></pre>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="n">counts</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</code></pre></div><pre><code>dict_keys(['2_0', '2_1'])
</code></pre>
<p>We can compare the similarity of the results using Numpy dot product of data x and y, with that of the above measurements. As we can see, the results are over 99.9% similar.</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="k">print</span><span class="p">(</span><span class="s2">&#34;</span><span class="si">% d</span><span class="s2">ifference between numpy to quantum encoded and measured result: {}%&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
    <span class="mi">100</span><span class="o">*</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span><span class="o">/</span><span class="n">num_qubits</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">counts</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">num_qubits</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&#34;_&#34;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="mi">0</span><span class="p">)]</span><span class="o">/</span><span class="n">num_samples</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span><span class="o">/</span><span class="n">num_qubits</span><span class="p">)</span>
<span class="p">))</span>
</code></pre></div><pre><code>% difference between numpy to quantum encoded and measured result: 0.14998285317752477%
</code></pre>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="n">num_qubits</span> <span class="o">=</span> <span class="mi">2</span>

<span class="c1">#Register indices</span>
<span class="n">qreg_work</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_qubits</span><span class="p">)</span>
<span class="n">qreg_aux</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">qreg_work</span><span class="p">)</span>

<span class="c1">#Prepare the GHZ state on qubits 1,2, and use 0 as the control qubit for Rotations</span>
<span class="n">q_circ</span> <span class="o">=</span> <span class="n">p</span><span class="p">(</span><span class="n">num_qubits</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">use_fusion</span><span class="p">);</span> <span class="c1">#Entangled state for storing vectors and aux qubit</span>
    
<span class="k">for</span> <span class="n">th</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="n">counts</span> <span class="o">=</span> <span class="p">{}</span>
    
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_samples</span><span class="p">):</span>
        <span class="n">q_circ</span><span class="o">.</span><span class="n">initRegister</span><span class="p">()</span>
        <span class="n">q_circ</span><span class="o">.</span><span class="n">applyGateH</span><span class="p">(</span><span class="n">qreg_aux</span><span class="p">);</span>           

        <span class="c1">#Encode the data to test</span>
        <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">num_qubits</span>
        <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">th</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">th</span><span class="p">)]</span><span class="o">*</span><span class="n">num_qubits</span>
        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="mi">2</span><span class="p">):</span>
            <span class="n">q_circ</span><span class="o">.</span><span class="n">applyGateCRotY</span><span class="p">(</span><span class="n">qreg_aux</span><span class="p">,</span> <span class="n">qreg_work</span><span class="p">[</span><span class="n">ii</span><span class="o">//</span><span class="mi">2</span><span class="p">],</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">ii</span><span class="p">]))</span>

        <span class="c1">#Next, encode the reference data by flipping the first bit to allow it into the |11&gt; state</span>
        <span class="n">q_circ</span><span class="o">.</span><span class="n">applyGateX</span><span class="p">(</span><span class="n">qreg_aux</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">),</span><span class="mi">2</span><span class="p">):</span>
            <span class="n">q_circ</span><span class="o">.</span><span class="n">applyGateCRotY</span><span class="p">(</span><span class="n">qreg_aux</span><span class="p">,</span> <span class="n">qreg_work</span><span class="p">[</span><span class="n">ii</span><span class="o">//</span><span class="mi">2</span><span class="p">],</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">ii</span><span class="p">]))</span>

        <span class="c1">#Encode the information into the phase of the auxiliary qubit        </span>
        <span class="n">q_circ</span><span class="o">.</span><span class="n">applyGateH</span><span class="p">(</span><span class="n">qreg_aux</span><span class="p">)</span>

        <span class="c1">#Extract result from aux qubit measurement</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">q_circ</span><span class="o">.</span><span class="n">applyMeasurementToRegister</span><span class="p">([</span><span class="n">qreg_aux</span><span class="p">],</span> <span class="bp">True</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">num_qubits</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&#34;_&#34;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="ow">in</span> <span class="n">counts</span><span class="p">:</span>
            <span class="n">counts</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">num_qubits</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&#34;_&#34;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="p">)]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">counts</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">num_qubits</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&#34;_&#34;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">counts</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;INSERT INTO q_states(state_key, dtheta, counts, num_qubits, measured_reg) 
</span><span class="s1">                    VALUES(?,?,?,?,?)&#39;&#39;&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">th</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">num_qubits</span><span class="p">,</span> <span class="s1">&#39;aux&#39;</span><span class="p">))</span>                         
    <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="c1">#Extract the unique state labels and angles for plotting</span>
<span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;SELECT DISTINCT state_key FROM q_states &#39;&#39;&#39;</span><span class="p">)</span>
<span class="n">uniq_states</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()]</span>
<span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;SELECT DISTINCT dtheta FROM q_states &#39;&#39;&#39;</span><span class="p">)</span>
<span class="n">angles</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()]</span>
</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="c1">#Extract the appropriate data from the DB and plot the results</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>

<span class="n">counts_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">uniq_states</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">angles</span><span class="p">)));</span>
<span class="k">for</span> <span class="n">c_jj</span><span class="p">,</span> <span class="n">v_jj</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">uniq_states</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">c_ii</span><span class="p">,</span> <span class="n">v_ii</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">angles</span><span class="p">):</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;SELECT counts, state_key, dtheta FROM q_states WHERE dtheta=? AND state_key=?&#39;&#39;&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">v_ii</span><span class="p">,</span> <span class="n">v_jj</span><span class="p">,)</span> <span class="p">)</span>
        <span class="n">all_rows</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">all_rows</span><span class="p">:</span>
            <span class="n">counts_arr</span><span class="p">[</span><span class="n">c_jj</span><span class="p">][</span><span class="n">c_ii</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
            
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.figsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">15</span><span class="p">]</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">counts_arr</span><span class="o">/</span><span class="n">num_samples</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;RdBu&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">([</span><span class="n">i</span><span class="o">*</span><span class="mi">16</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">3</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">]],</span> <span class="p">[</span><span class="s1">&#39;0&#39;</span><span class="p">,</span> <span class="s1">&#39;pi/2&#39;</span><span class="p">,</span> <span class="s1">&#39;pi&#39;</span><span class="p">,</span> <span class="s1">&#39;3pi/2&#39;</span><span class="p">,</span> <span class="s1">&#39;2pi&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">uniq_states</span><span class="p">)),</span> <span class="n">uniq_states</span><span class="p">)</span>
<span class="n">cbar</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="c1">#Equivalent data in lineplot, which hides overlap of crossed states</span>
<span class="k">for</span> <span class="n">c_jj</span><span class="p">,</span> <span class="n">v_jj</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">uniq_states</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">angles</span><span class="p">,</span> <span class="n">counts_arr</span><span class="p">[</span><span class="n">c_jj</span><span class="p">][:]</span><span class="o">/</span><span class="n">num_samples</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">v_jj</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</code></pre></div><p><img src="/img/small_encode.png" alt="png"></p>
<p>For a 2 qubit (4 float) data set, as the vector is rotated through a variety of angles relative to the reference, we can see occupation of the $|00\rangle$ state (which is $100%$ at $\Delta\theta=0$), lessens, and states $|01\rangle$ and $|10\rangle$ have non-negligible counts (not shown as requires measurement of the register). As the vector is rotated to $\pi/2$, the occupation of the $|01\rangle$ and $|10\rangle$ drops off, and the $|11\rangle$ state approaches $50%$, along with $|00\rangle$. This implies that the states are now maximally entangled, in state $\left(|00\rangle + |11\rangle\right)/\sqrt{2}$, with further rotations causing an oscillation through these probabilities back to the original states.</p>
<p>As such, when the vector is the same, $P(|00\rangle) = 100%$ $P(\textrm{all others}) = 0%$, and when they are orthogonal $P(|00\rangle) =50%$ and $P(|11\rangle)=50%$.</p>
<p>Measuring the auxiliary bit as implied by PRL 114, 110504 (2015) however does not allow us to extract any information, as measurements of the full state is required.  Applying an additional H gate to the circuit does change this, but leaves us with a large plateau in the region approaching vector orthogonality for larger qubit registers.</p>
<h1 id="4-qubit-register-upto-16-floating-point-values">4 qubit register (upto 16 floating-point values)</h1>
<p>If we choose to measure the auxiliary qubit first, we essentially transform the state as follows: for an angle of 0 the auxiliary qubit result is completely separable from the register values as the states are
$\left(1/\sqrt{2}\right)\left(\vert 0 \rangle + \vert 1 \rangle \right)\vert 0000 \rangle $. When the states are orthogonal, it becomes $\left( \vert 0 \rangle \vert 0000\rangle + \vert 1 \rangle \vert 1111 \rangle \right)(1/\sqrt{2})$ which is maximally entangled.</p>
<p>However, more realistically, we can assume the states of the system can be described as $\left( \vert 0 \rangle \vert \alpha\rangle + \vert 1 \rangle \vert \beta \rangle \right)(c/\sqrt{2})$, where $\alpha, ~\beta$ are the respective arbitrary states to be compared, and $c$ is the normalisation coefficient of the register excluding the auxiliary qubit. Given the above state, performing a Hadamard gate on the resulting auxiliary qubit modifies the overall state to $$\vert \psi \rangle = d\left(\vert 0 \rangle \left( \vert \alpha\rangle + \vert\beta\rangle \right) + \vert 1 \rangle \left( \vert \alpha\rangle - \vert\beta\rangle \right)\right) \\ = d\left(\vert 0 \rangle + \vert 1 \rangle \frac{\vert \alpha\rangle - \vert\beta\rangle}{ \vert \alpha\rangle + \vert\beta\rangle }\right)
$$.</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="n">num_qubits</span> <span class="o">=</span> <span class="mi">4</span>

<span class="c1">#Register indices</span>
<span class="n">qreg_work</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_qubits</span><span class="p">)</span>
<span class="n">qreg_aux</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">qreg_work</span><span class="p">)</span>

<span class="n">q_circ</span> <span class="o">=</span> <span class="n">p</span><span class="p">(</span><span class="n">num_qubits</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">use_fusion</span><span class="p">);</span> <span class="c1">#Entangled state for storing vectors and aux qubit</span>
    
<span class="k">for</span> <span class="n">th</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="n">counts</span> <span class="o">=</span> <span class="p">{}</span>
    
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_samples</span><span class="p">):</span>
        <span class="n">q_circ</span><span class="o">.</span><span class="n">initRegister</span><span class="p">()</span>
        <span class="n">q_circ</span><span class="o">.</span><span class="n">applyGateH</span><span class="p">(</span><span class="n">qreg_aux</span><span class="p">);</span>           

        <span class="c1">#Encode the data to test</span>
        <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">num_qubits</span>
        <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">th</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">th</span><span class="p">)]</span><span class="o">*</span><span class="n">num_qubits</span>
        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="mi">2</span><span class="p">):</span>
            <span class="n">q_circ</span><span class="o">.</span><span class="n">applyGateCRotY</span><span class="p">(</span><span class="n">qreg_aux</span><span class="p">,</span> <span class="n">qreg_work</span><span class="p">[</span><span class="n">ii</span><span class="o">//</span><span class="mi">2</span><span class="p">],</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">ii</span><span class="p">]))</span>

        <span class="c1">#Next, encode the reference data by flipping the first bit to allow it into the |11&gt; state</span>
        <span class="n">q_circ</span><span class="o">.</span><span class="n">applyGateX</span><span class="p">(</span><span class="n">qreg_aux</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">),</span><span class="mi">2</span><span class="p">):</span>
            <span class="n">q_circ</span><span class="o">.</span><span class="n">applyGateCRotY</span><span class="p">(</span><span class="n">qreg_aux</span><span class="p">,</span> <span class="n">qreg_work</span><span class="p">[</span><span class="n">ii</span><span class="o">//</span><span class="mi">2</span><span class="p">],</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">ii</span><span class="p">]))</span>

        <span class="c1">#Encode the information into the phase of the auxiliary qubit        </span>
        <span class="n">q_circ</span><span class="o">.</span><span class="n">applyGateH</span><span class="p">(</span><span class="n">qreg_aux</span><span class="p">)</span>

        <span class="c1">#Extract result from aux qubit measurement</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">q_circ</span><span class="o">.</span><span class="n">applyMeasurementToRegister</span><span class="p">([</span><span class="n">qreg_aux</span><span class="p">],</span> <span class="bp">True</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">num_qubits</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&#34;_&#34;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="ow">in</span> <span class="n">counts</span><span class="p">:</span>
            <span class="n">counts</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">num_qubits</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&#34;_&#34;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="p">)]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">counts</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">num_qubits</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&#34;_&#34;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">counts</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;INSERT INTO q_states(state_key, dtheta, counts, num_qubits, measured_reg) 
</span><span class="s1">                    VALUES(?,?,?,?,?)&#39;&#39;&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">th</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">num_qubits</span><span class="p">,</span> <span class="s1">&#39;aux&#39;</span><span class="p">))</span>                         
    <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="c1"># Update unique list of states from DB</span>
<span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;SELECT DISTINCT state_key FROM q_states &#39;&#39;&#39;</span><span class="p">)</span>
<span class="n">uniq_states</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()]</span>
</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="c1">#Extract the appropriate data from the DB and plot the results</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>

<span class="n">counts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">uniq_states</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">angles</span><span class="p">)));</span>
<span class="k">for</span> <span class="n">c_jj</span><span class="p">,</span> <span class="n">v_jj</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">uniq_states</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">c_ii</span><span class="p">,</span> <span class="n">v_ii</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">angles</span><span class="p">):</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;SELECT counts, state_key, dtheta FROM q_states WHERE dtheta=? AND state_key=?&#39;&#39;&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">v_ii</span><span class="p">,</span> <span class="n">v_jj</span><span class="p">,)</span> <span class="p">)</span>
        <span class="n">all_rows</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">all_rows</span><span class="p">:</span>
            <span class="n">counts</span><span class="p">[</span><span class="n">c_jj</span><span class="p">][</span><span class="n">c_ii</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
            
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.figsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">15</span><span class="p">]</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">counts</span><span class="o">/</span><span class="n">num_samples</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;RdBu&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">([</span><span class="n">i</span><span class="o">*</span><span class="mi">16</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">3</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">]],</span> <span class="p">[</span><span class="s1">&#39;0&#39;</span><span class="p">,</span> <span class="s1">&#39;pi/2&#39;</span><span class="p">,</span> <span class="s1">&#39;pi&#39;</span><span class="p">,</span> <span class="s1">&#39;3pi/2&#39;</span><span class="p">,</span> <span class="s1">&#39;2pi&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">uniq_states</span><span class="p">)),</span> <span class="n">uniq_states</span><span class="p">)</span>
<span class="n">cbar</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">)</span>
</code></pre></div><p><img src="/img/small_encode_pcolor.png" alt="png"></p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="c1">#Equivalent data in lineplot, which hides overlap of crossed states</span>
<span class="k">for</span> <span class="n">c_jj</span><span class="p">,</span> <span class="n">v_jj</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">uniq_states</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">angles</span><span class="p">,</span> <span class="n">counts</span><span class="p">[</span><span class="n">c_jj</span><span class="p">][:]</span><span class="o">/</span><span class="n">num_samples</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">uniq_states</span><span class="p">)</span>
</code></pre></div><p><img src="/img/multiline_encode.png" alt="png"></p>
<p>As can be seen, the central region platueaus for increased qubit register size.</p>
<div class="edit-meta">
Last updated on 1 Mar 2020


<br>
Published on 1 Mar 2020
<br><a href="examples/float_encode/_index.md/edit/master/content/examples/float_encode/_index.md" class="edit-page"><i class="fas fa-pen-square"></i> Edit on GitHub</a></div><nav class="pagination"><a class="nav nav-prev" href="/examples/large_scale/" title="Distributed QNLP example"><i class="fas fa-arrow-left" aria-hidden="true"></i> Prev - Distributed QNLP example</a>
<a class="nav nav-next" href="/examples/pre_proc_params/" title="Example of parameter analysis">Next - Example of parameter analysis <i class="fas fa-arrow-right" aria-hidden="true"></i></a>
</nav><footer><p class="powered">Powered by <a href="https://gohugo.io">Hugo</a>. Theme by <a href="https://themes.gohugo.io/hugo-theme-techdoc/">TechDoc</a>. Designed by <a href="https://github.com/thingsym/hugo-theme-techdoc">Thingsym</a>.</p>
</footer>
</main><div class="sidebar">

<nav class="slide-menu">
<ul>
<li class=""><a href="/">Home</a></li>

<li class="parent has-sub-menu"><a href="/examples/">Example library usage<span class="mark opened">-</span></a>
  
<ul class="sub-menu">

<li class=""><a href="/examples/large_scale/">Distributed QNLP example</a>
  
</li>

<li class="parent active"><a href="/examples/float_encode/">Encoding data into state coefficients</a>
  
</li>

<li class=""><a href="/examples/pre_proc_params/">Example of parameter analysis</a>
  
</li>

<li class=""><a href="/examples/gate_ops/">GateOps usage example</a>
  
</li>

<li class=""><a href="/examples/qnlp_python/">QNLP example</a>
  
</li>

<li class=""><a href="/examples/vqe/">VQE usage example</a>
  
</li>
</ul>
  
</li>

<li class=""><a href="/install/">Installation instructions</a>
  
</li>
</ul>
</nav>



<div class="sidebar-footer"></div>
</div>
</div><a href="#" id="backtothetop-fixed" class="backtothetop"
 data-backtothetop-duration="600"
 data-backtothetop-easing="easeOutQuart"
 data-backtothetop-fixed-fadeIn="1000"
 data-backtothetop-fixed-fadeOut="1000"
 data-backtothetop-fixed-bottom="10"
 data-backtothetop-fixed-right="20">
<span class="fa-layers fa-fw">
<i class="fas fa-circle"></i>
<i class="fas fa-arrow-circle-up"></i>
</span></a>
</div>
</body>
</html>
